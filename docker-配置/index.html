<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Docker 基础 - mufasa 个人站</title><meta name="Description" content="mufasa 个人站"><meta property="og:title" content="Docker 基础" />
<meta property="og:description" content="安装 Windows 上 Docker 需要基于 Hyper-V 或者 WSL2。在“启用或关闭 Windows 功能”中勾选 &ldquo;Hyper-V&rdquo; 和“容器”，进而再安装 Docker Desktop。 安装 Docker Desktop 后可以 Settings &ndash;&gt; Resources &ndash;&gt; WSL Integration 选择 Enable integration with" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kali20177.github.io/docker-%E9%85%8D%E7%BD%AE/" /><meta property="og:image" content="https://kali20177.github.io/logo.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-03-09T19:17:37+08:00" />
<meta property="article:modified_time" content="2024-03-09T19:17:37+08:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://kali20177.github.io/logo.png" /><meta name="twitter:title" content="Docker 基础"/>
<meta name="twitter:description" content="安装 Windows 上 Docker 需要基于 Hyper-V 或者 WSL2。在“启用或关闭 Windows 功能”中勾选 &ldquo;Hyper-V&rdquo; 和“容器”，进而再安装 Docker Desktop。 安装 Docker Desktop 后可以 Settings &ndash;&gt; Resources &ndash;&gt; WSL Integration 选择 Enable integration with"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kali20177.github.io/docker-%E9%85%8D%E7%BD%AE/" /><link rel="prev" href="https://kali20177.github.io/vscode-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" /><link rel="next" href="https://kali20177.github.io/whisper-%E8%AF%AD%E9%9F%B3%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Docker 基础",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kali20177.github.io\/docker-%E9%85%8D%E7%BD%AE\/"
        },"genre": "posts","wordcount":  3844 ,
        "url": "https:\/\/kali20177.github.io\/docker-%E9%85%8D%E7%BD%AE\/","datePublished": "2024-03-09T19:17:37+08:00","dateModified": "2024-03-09T19:17:37+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "mufasa"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="mufasa 个人站">Mufasa&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="mufasa 个人站">Mufasa&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Docker 基础</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>mufasa</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-03-09">2024-03-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 3844 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 8 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#安装">安装</a></li>
    <li><a href="#概念">概念</a></li>
    <li><a href="#基础命令">基础命令</a></li>
    <li><a href="#ui-工具">UI 工具</a></li>
    <li><a href="#ssh-以及基础编译环境配置">SSH 以及基础编译环境配置</a>
      <ul>
        <li><a href="#ubuntu">Ubuntu</a></li>
        <li><a href="#alpine">alpine</a></li>
        <li><a href="#fedora">Fedora</a></li>
        <li><a href="#mcr">mcr</a></li>
      </ul>
    </li>
    <li><a href="#私有-registry">私有 Registry</a></li>
    <li><a href="#gui">GUI</a>
      <ul>
        <li><a href="#windows">Windows</a></li>
        <li><a href="#linux">Linux</a></li>
      </ul>
    </li>
    <li><a href="#嵌入式-debug">嵌入式 Debug</a>
      <ul>
        <li><a href="#方法一">方法一</a></li>
        <li><a href="#方法二">方法二</a></li>
        <li><a href="#方法三">方法三</a></li>
      </ul>
    </li>
    <li><a href="#harbor">Harbor</a></li>
    <li><a href="#vscode">VSCode</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="安装">安装</h2>
<p>Windows 上 Docker 需要基于 Hyper-V 或者 WSL2。在“启用或关闭 Windows 功能”中勾选 &ldquo;Hyper-V&rdquo; 和“容器”，进而再安装 Docker Desktop。</p>
<p>安装 Docker Desktop 后可以 Settings &ndash;&gt; Resources &ndash;&gt; WSL Integration 选择 Enable integration with additional distros。这样 WSL2 中即可直接使用 Windows 上安装的 Docker 环境。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Docker_img/wsl_docker.png"
        data-srcset="/Docker_img/wsl_docker.png, /Docker_img/wsl_docker.png 1.5x, /Docker_img/wsl_docker.png 2x"
        data-sizes="auto"
        alt="/Docker_img/wsl_docker.png"
        title="wsl_docker" /></p>
<p>但槽点是，如果安装过 Docker Desktop，则可能会改变 WSL 的默认系统设置，导致 VSCode 选择“连接到 WSL”选项时，会连接到 docker-desktop 导致失败。下面的选项修改默认设置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; wsl -l -v
</span></span><span class="line"><span class="cl">  NAME                   STATE           VERSION
</span></span><span class="line"><span class="cl">* docker-desktop         Stopped         <span class="m">2</span>
</span></span><span class="line"><span class="cl">  docker-desktop-data    Stopped         <span class="m">2</span>
</span></span><span class="line"><span class="cl">  Arch                   Stopped         <span class="m">2</span>
</span></span><span class="line"><span class="cl">  Ubuntu-24.04           Running         <span class="m">2</span>
</span></span><span class="line"><span class="cl">&gt; wslconfig /setdefault Ubuntu-24.04
</span></span></code></pre></td></tr></table>
</div>
</div><p>Linux 上可以直接使用 apt 的源下载 Ubuntu 维护的社区版 docker。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt install apt-transport-https ca-certificates curl gnupg lsb-release usbutils
</span></span><span class="line"><span class="cl">sudo apt install docker.io docker-compose docker-doc
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装完成后，docker 默认 root 用户才能访问，所以要添加当前用户名到 docker 组中。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo usermod -aG docker <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行后需要重启，重启后输入以下命令查看用户名是否被添加到组中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">id -nG
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在直接执行 docker 命令就不会报错。</p>
<h2 id="概念">概念</h2>
<ul>
<li>image: 一个只读的模板，可以用来创建 Docker 容器。相当于安装虚拟机时的 iso 文件。</li>
<li>container: 容器镜像的运行实例。</li>
<li>dockerfile: 用于制作、部署容器镜像的配置文件。</li>
</ul>
<p>容器和虚拟机的区别可以参考<a href="https://www.redhat.com/zh/topics/containers/whats-a-linux-container#%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8E%E5%AE%B9%E5%99%A8%E5%8C%BA%E5%88%AB" target="_blank" rel="noopener noreffer ">虚拟机与容器区别</a>。</p>
<h2 id="基础命令">基础命令</h2>
<p>首先建议换阿里源，如果在 Linux 命令行下使用，可以通过修改 daemon 配置文件 <code>/etc/docker/daemon.json</code> 实现，保存重新加载 daemon 并重启容器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">daemon</span><span class="o">.</span><span class="n">json</span> <span class="o">&lt;&lt;-</span><span class="s1">&#39;EOF&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;registry-mirrors&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;https://xxx.mirror.aliyuncs.com&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;insecure-registries&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ip:port&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">EOF</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
</span></span><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">restart</span> <span class="n">docker</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果使用 Docker Desktop 则可以在 settings 的 <code>Docker Engine</code> 选项中直接编辑。</p>
<p>常用命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 从互联网拉取名为 ubuntu 的容器</span>
</span></span><span class="line"><span class="cl">docker pull ubuntu 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 首次从镜像创建名为 MyContainer 的容器实例，进入交互模式，运行程序 zsh</span>
</span></span><span class="line"><span class="cl">docker run -it --name MyContainer ubuntu zsh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 首次启动一个特权容器，映射了外部 linux usb 设备，硬件调试需要</span>
</span></span><span class="line"><span class="cl">docker run -it --name MyContainer --privileged -v /dev/bus/usb/:/dev/bus/usb ubuntu zsh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查询容器实例列表</span>
</span></span><span class="line"><span class="cl">docker ps -a  <span class="c1"># 显示当前容器 ID 和容器名</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 提交容器变更，产生名为 ubuntu:base 的新镜像 -a: 作者，-m: 说明</span>
</span></span><span class="line"><span class="cl">docker commit -a <span class="s2">&#34;mufasa&#34;</span> -m <span class="s2">&#34;change mirror&#34;</span> container-id ubuntu:base
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 再次启动容器实例</span>
</span></span><span class="line"><span class="cl">docker start MyContainer
</span></span><span class="line"><span class="cl"><span class="c1"># 进入交互模式（运行 zsh）</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it MyContainer zsh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除容器实例，可通过容器 id 号或者容器名称</span>
</span></span><span class="line"><span class="cl">docker rm <span class="si">${</span><span class="nv">CONTAINER</span><span class="p"> ID</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">docker rm <span class="si">${</span><span class="nv">NAMES</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除镜像</span>
</span></span><span class="line"><span class="cl">docker rmi <span class="si">${</span><span class="nv">REPOSITORY</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 保存当前 image 为 tar 文件</span>
</span></span><span class="line"><span class="cl">docker save ubuntu &gt; ubuntu.tar <span class="c1"># linux</span>
</span></span><span class="line"><span class="cl">docker save --output ubuntu.tar ubuntu
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导入 image</span>
</span></span><span class="line"><span class="cl">docker load &lt; ubuntu.tar <span class="c1"># linux</span>
</span></span><span class="line"><span class="cl">docker load --input ubuntu.tar
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ui-工具">UI 工具</h2>
<ul>
<li>docker desktop</li>
<li>lazydocker</li>
<li>VSCode docker 插件</li>
</ul>
<h2 id="ssh-以及基础编译环境配置">SSH 以及基础编译环境配置</h2>
<h3 id="ubuntu">Ubuntu</h3>
<p>ubuntu 默认镜像拉取后需要先使用默认源安装 ca-certificates，之后才能换源。</p>
<p>由于容器默认没有文本编辑器，可以使用 cat 或者 echo 用重定向标准输入的方式直接覆盖源文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat &gt;/etc/apt/sources.list
</span></span><span class="line"><span class="cl"><span class="c1"># 获取输入内容...，Ctrl + d 结束</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装 OpenSSH 服务，设置 root 密码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install openssh-server
</span></span><span class="line"><span class="cl">passwd:
</span></span><span class="line"><span class="cl"><span class="c1"># 修改密码</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>OpenSSH 的客户端软件是 ssh，服务器软件是 sshd，服务器默认监听端口是 22。启动镜像时分配端口号映射，把本机的 6789 端口映射到容器 22 号端口：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -itd -p 6789:22 image-name
</span></span></code></pre></td></tr></table>
</div>
</div><p>Windows powershell 下可以使用 <code>netstat -a</code> 查看端口 6789 是否被正常打开。使用 exec 和运行中的容器交互：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it container-id /bin/bash
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改容器中的 sshd_config 配置文件，开启密码访问：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">vim /etc/ssh/sshd_config
</span></span><span class="line"><span class="cl"><span class="c1">#PermitRootLogin prohibit-password   在此行后添加</span>
</span></span><span class="line"><span class="cl">PermitRootLogin yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>在容器中执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">service ssh start
</span></span><span class="line"><span class="cl"><span class="c1"># 或者</span>
</span></span><span class="line"><span class="cl">/etc/init.d/ssh start
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时本机终端可以连接容器内部。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="n">ssh</span> <span class="n">root</span><span class="nv">@127</span><span class="p">.</span><span class="py">0</span><span class="p">.</span><span class="py">0</span><span class="p">.</span><span class="py">1</span> <span class="n">-p</span> <span class="mf">6789</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>对于 Windows，系统变量下默认的 ssh 工具连接会存在问题，建议更换成 git 安装目录下 /usr/ssh.exe</p>
</blockquote>
<p>对于 VSCode，安装插件 Remote SSH 后，选择<strong>将当前窗口连接到主机</strong>，填写 <code>ssh root@127.0.0.1 -p 6789</code>，输入密码即可连接完成。</p>
<p>使用 ssh 复制文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 远程复制到本机，scp 命令已经不再推荐</span>
</span></span><span class="line"><span class="cl">scp -p <span class="m">22</span> username@ipaddress:/home/xxx/ .
</span></span><span class="line"><span class="cl"><span class="c1"># 复制文件到远程</span>
</span></span><span class="line"><span class="cl">rsync -p <span class="m">22</span> filename username@ipaddress:/home/xxx/ 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="alpine">alpine</h3>
<p>alpine 发行版更加轻量，并且不需要安装 ca-certificates 换源，比较容易写 Dockerfile。alpine 使用 apk 作为包管理工具，且没有 bash。基础编译工具通过 <code>apk add build-base</code> 安装。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">apk add openrc openssh iptables
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">rc-update add sshd
</span></span><span class="line"><span class="cl">rc-status  <span class="c1"># 确认 sshd 监听状态</span>
</span></span><span class="line"><span class="cl">rc-service sshd start
</span></span></code></pre></td></tr></table>
</div>
</div><p>其他步骤和 ubuntu 中相同。</p>
<h3 id="fedora">Fedora</h3>
<p>RedHat 维护的发行版，默认安装的编译环境较新。使用 dnf 作为包管理器。但是默认甚至不支持 <code>clear</code> 命令。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo dnf group install <span class="s2">&#34;C Development Tools and Libraries&#34;</span> <span class="s2">&#34;Development Tools&#34;</span>
</span></span><span class="line"><span class="cl">sudo dnf install ncurses   <span class="c1"># 支持 clear</span>
</span></span><span class="line"><span class="cl">sudo dnf install clang-tools-extra   <span class="c1"># 安装 clangd</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="mcr">mcr</h3>
<p>微软官方 DevContainer 插件官方维护的系列容器，在普通容器的基础上添加了权限管理，zsh 和一个名为 vscode 的非 root 用户，已经配置了一些常用的系统工具。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull mcr.microsoft.com/devcontainers/base:ubuntu
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="私有-registry">私有 Registry</h2>
<p>为了在 Dockerfile 中使用自定义的镜像，并且分享镜像到局域网，需要使用 Docker Registry 容器。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull registry
</span></span><span class="line"><span class="cl">docker run --name MyHub -d -p 5000:5000 -v /f/docker_registry:/var/lib/registry registry
</span></span></code></pre></td></tr></table>
</div>
</div><p>启动时添加映射端口，添加局域网或本地存放仓库的位置到容器路径 <code>/var/lib/registry</code> 的映射。启动后需要给要上传的镜像打上标签，这里以镜像 alpine:cpp 为例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker tag alpine:cpp your_ip:5000/alpine:cpp
</span></span></code></pre></td></tr></table>
</div>
</div><p>上传之前先添加局域网 ip:port 到 Docker Engine 的 json 文件中，否则会上传失败。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;builder&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;gc&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;defaultKeepStorage&#34;</span><span class="p">:</span> <span class="s2">&#34;20GB&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;enabled&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;experimental&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="err">#</span> <span class="err">添加此段</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;insecure-registries&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ip:port&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;ip:port&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>点击应用并重启镜像，上传：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker push your_ip:5000/alpine:cpp
</span></span></code></pre></td></tr></table>
</div>
</div><p>只要局域网内其他人也添加了相同的 <code>&quot;insecure-registries&quot;</code> 字段，就能访问 registry 容器内的自定义镜像。下载命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker pull your_ip:5000/alpine:cpp
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果局域网内有多个镜像，可以使用 curl 查看本地镜像列表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl your_ip:5000/v2/_catalog
</span></span></code></pre></td></tr></table>
</div>
</div><p>如果只是本机使用，可以在 tag 和 push 阶段直接使用主机环回地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker tag ubuntu:latest 127.0.0.1:5000/ubuntu:latest
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种情况下无需编辑 Docker Engine 中的 json 文件即可拉取自定义镜像。</p>
<h2 id="gui">GUI</h2>
<h3 id="windows">Windows</h3>
<p>在 Windows 下安装带有 X11 服务的软件，例如 X410，VcXsrv，MobaXterm 等。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Docker_img/x-display-server-overview.png"
        data-srcset="/Docker_img/x-display-server-overview.png, /Docker_img/x-display-server-overview.png 1.5x, /Docker_img/x-display-server-overview.png 2x"
        data-sizes="auto"
        alt="/Docker_img/x-display-server-overview.png"
        title="x-display" /></p>
<p>编写下列的 Dockerfile，以简单钟表程序 xarclock 为例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> ubuntu:18.04</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 换源操作略</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># 安装 xarclock</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y xarclock<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /usr/bin/xarclock<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>使用以下命令构建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker build -t xarclock .
</span></span><span class="line"><span class="cl">docker run -ti --rm -e <span class="nv">DISPLAY</span><span class="o">=</span>host.docker.internal:0.0 xarclock
</span></span></code></pre></td></tr></table>
</div>
</div><p>Docker 推荐容器使用 host.docker.internal 来访问宿主机上的服务。输出乱码需要在容器中安装对应语言、地区和字体。</p>
<h3 id="linux">Linux</h3>
<p>Linux 同样通过 x11 服务显示，启动参数有所不同：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo apt install x11-xserver-utils
</span></span><span class="line"><span class="cl">sudo xhost +
</span></span><span class="line"><span class="cl"><span class="c1"># access control disabled, clients can connect from any host</span>
</span></span><span class="line"><span class="cl">docker run -it 
</span></span><span class="line"><span class="cl">    -v /etc/localtime:/etc/localtime:ro <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -v /tmp/.X11-unix:/tmp/.X11-unix <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e <span class="nv">DISPLAY</span><span class="o">=</span>unix<span class="nv">$DISPLAY</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e GDK_SCALE <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -e GDK_DPI_SCALE <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --name GUITEST ubuntu zsh
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="嵌入式-debug">嵌入式 Debug</h2>
<p>Windows 下 WSL 环境的容器，目前对宿主机设备的访问支持不完善，无法直接调试。Linux 主机上的容器可以通过设备映射的方式 Debug。</p>
<h3 id="方法一">方法一</h3>
<p>J-Link 官方提供了在 Linux 宿主机上直接用设备映射访问调试器的文档，容器内需要安装 <code>lsusb</code> 支持。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install usbutils
</span></span><span class="line"><span class="cl">sudo docker run -t -i --privileged -v /dev/bus/usb/:/dev/bus/usb ubuntu bash
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="方法二">方法二</h3>
<p>在 Windows 的容器环境下，比较容易做到的方法是使用 GdbServer 进行远程调试。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Docker_img/docker-jlink.png"
        data-srcset="/Docker_img/docker-jlink.png, /Docker_img/docker-jlink.png 1.5x, /Docker_img/docker-jlink.png 2x"
        data-sizes="auto"
        alt="/Docker_img/docker-jlink.png"
        title="docker-jlink" /></p>
<blockquote>
<p>gdbserver is a control program for Unix-like systems, which allows you to connect your program with a remote GDB via target remote or target extended-remote—but without linking in the usual debugging stub.</p>
</blockquote>
<p>在使用 cortex-debug 插件和 J-Link 的情况下，在 launch.json 中添加如下配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Remote GdbServer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="s2">&#34;launch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;cortex-debug&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;cwd&#34;</span><span class="p">:</span> <span class="s2">&#34;${workspaceFolder}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;executable&#34;</span><span class="p">:</span> <span class="s2">&#34;./build/xxx.elf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;runToEntryPoint&#34;</span><span class="p">:</span> <span class="s2">&#34;main&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;showDevDebugOutput&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;servertype&#34;</span><span class="p">:</span> <span class="s2">&#34;external&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;preRestartCommands&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;file ./build/xxx.elf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;load&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;enable breakpoint&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;monitor reset&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;monitor halt&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;gdbPath&#34;</span><span class="p">:</span> <span class="s2">&#34;gdb-multiarch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;objdumpPath&#34;</span><span class="p">:</span> <span class="s2">&#34;arm-none-eabi-objdump&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;gdbTarget&#34;</span><span class="p">:</span> <span class="s2">&#34;host.docker.internal:2331&#34;</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>调试前在 Windows 端打开 J-LinkGDBServer.exe，选择设备和接口类型。arm-none-eabi-gdb 在容器中用 tcp 通过端口 2331 实现和宿主机中 J-LinkGDBServer 的通信。从而实现正常的调试功能。</p>
<p>Linux 下如果要使用图形化的 JlinkGdbServer, 需要下载 libqtgui4</p>
<p>使用 openocd 也能实现类似的功能。</p>
<h3 id="方法三">方法三</h3>
<p>也可以直接使用 J-Link Remote Server，配置正确的 IP 地址实现调试。以 LAN mode 在宿主机启动 J-Link Remote Server。添加如下的调试配置：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Remote IP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="s2">&#34;launch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;cortex-debug&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;cwd&#34;</span><span class="p">:</span> <span class="s2">&#34;${workspaceFolder}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;executable&#34;</span><span class="p">:</span> <span class="s2">&#34;./build/xxx.elf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;device&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;interface&#34;</span><span class="p">:</span> <span class="s2">&#34;swd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;runToEntryPoint&#34;</span><span class="p">:</span> <span class="s2">&#34;main&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;showDevDebugOutput&#34;</span><span class="p">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;servertype&#34;</span><span class="p">:</span> <span class="s2">&#34;jlink&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;preRestartCommands&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;file ./build/xxx.elf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;load&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;enable breakpoint&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;monitor reset&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;monitor halt&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;gdbPath&#34;</span><span class="p">:</span> <span class="s2">&#34;gdb-multiarch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;objdumpPath&#34;</span><span class="p">:</span> <span class="s2">&#34;arm-none-eabi-objdump&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;serverpath&#34;</span><span class="p">:</span> <span class="s2">&#34;JLinkGDBServerCLExe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;ipAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx.xxx.xxx.xxx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>即直接使用本地的 JLinkGDBServerCLExe 服务，通过实际的 IP 地址远程调试。实际使用中经常断连，不推荐这样调试。</p>
<h2 id="harbor">Harbor</h2>
<p>Harbor 是一个开源的镜像仓库管理方案，集成了反向代理，数据库等功能。提供了网页的管理界面，能实现对镜像的访问控制，漏洞扫描等功能。可以在 WSL2 或者各种 Linux 发行版部署，目前不适用于 ARM 系列芯片的 MacOS 系统。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Docker_img/Harbor_Architecture.png"
        data-srcset="/Docker_img/Harbor_Architecture.png, /Docker_img/Harbor_Architecture.png 1.5x, /Docker_img/Harbor_Architecture.png 2x"
        data-sizes="auto"
        alt="/Docker_img/Harbor_Architecture.png"
        title="Harbor_Architecture" /></p>
<p>下载并解压 offline 版本的安装包后，首先完成配置文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cp harbor.yml.tmpl harbor.yml
</span></span><span class="line"><span class="cl">vim harbor.yml
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改 hostname 为对外访问的 IP 地址。默认 80 端口，暂时注释掉 HTTPS 部分的配置。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="c"># The IP address or hostname to access admin UI and registry service.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l">ip_addr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># http related config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">http</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># port for http, default is 80. If https enabled, this port will redirect to https port</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># https related config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># https:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># https port for harbor, default is 443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># port: 443</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># The path of cert and key files for nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># certificate: /your/certificate/path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># private_key: /your/private/key/path</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># enable strong ssl ciphers (default: false)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># strong_ssl_ciphers: false</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>配置完成后即可执行 <code>sudo ./install.sh</code> , <strong>执行安装前</strong>建议先像配置 Registry 一样将 <code>&quot;insecure-registries&quot;: [&quot;ip_addr:80&quot;] </code> 添加到 Docker Engine 的 json 文件中。</p>
<p>docker compose 服务启动后，可以在浏览器输入 <code>ip_addr:80</code> 访问 harbor 网页端，默认用户名 admin，密码：Harbor12345。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Docker_img/Harbor_login.png"
        data-srcset="/Docker_img/Harbor_login.png, /Docker_img/Harbor_login.png 1.5x, /Docker_img/Harbor_login.png 2x"
        data-sizes="auto"
        alt="/Docker_img/Harbor_login.png"
        title="Harbor_login" /></p>
<p>通过管理界面创建一个 push 镜像需要登陆，pull 没有限制的仓库，通过 <strong>新建项目</strong> 添加。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/Docker_img/public_hub.png"
        data-srcset="/Docker_img/public_hub.png, /Docker_img/public_hub.png 1.5x, /Docker_img/public_hub.png 2x"
        data-sizes="auto"
        alt="/Docker_img/public_hub.png"
        title="public_hub" /></p>
<p>下面将制作好的镜像上传到新建的 public 仓库，首先按照下面的<strong>格式</strong>修改镜像 tag：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker tag fedora:cpp ip_addr:80/public/fedora:cpp
</span></span></code></pre></td></tr></table>
</div>
</div><p>push 之前先在终端登录 Harbor：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt; docker login ip_addr:80
</span></span><span class="line"><span class="cl">Username: admin
</span></span><span class="line"><span class="cl">Password: 
</span></span><span class="line"><span class="cl">Login Succeeded
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; docker push ip_addr:80/public/fedora:cpp
</span></span></code></pre></td></tr></table>
</div>
</div><p>这样在网页后台就能看到上传的镜像，其他人可直接复制 pull 镜像的指令。</p>
<h2 id="vscode">VSCode</h2>
<p>容器和 VSCode 可以良好结合，需要安装插件 Docker 和 Dev Containers。进入 VSCode 点击远程可以选择附加到运行的容器打开。</p>
<blockquote>
<p>注意当首次进入容器时，VSCode 会在容器中安装 code-server 服务。如果当前网络环境不允许容器联网，需要手动拷贝 vscode-server 到容器内。在 &ldquo;关于&quot;中查看当前 VSCode 的“提交”commit-id，2023 年之前可以访问 <code>https://update.code.visualstudio.com/commit:${commit_id}/server-linux-x64/stable</code> , 2023 年之后访问 <code>https://vscode.download.prss.microsoft.com/dbazure/download/stable/${commit_id}/vscode-server-linux-x64.tar.gz</code>。</p>
</blockquote>
<p>code-server 服务安装的位置和容器的用户名有关，例如对于微软的 <a href="https://github.com/devcontainers/images/tree/main/src" target="_blank" rel="noopener noreffer ">mcr</a> 系列容器镜像，在 <code>/home</code> 下定义了一个名为 vscode 的非 root 用户。因此 code-server 会被安装在 <code>/home/vscode/.vscode-server/bin/commit-id</code>。而普通容器默认用户是 root，那么 code-server 会安装在 <code>/root/.vscode-server/bin/commit-id</code>。</p>
<h2 id="参考">参考</h2>
<ol>
<li><a href="https://skychang.github.io/2017/01/06/Docker-Docker_for_Windows_10_First/" target="_blank" rel="noopener noreffer ">Docker - Docker for Windows 10 入門篇</a></li>
<li><a href="https://blog.csdn.net/weixin_43425561/article/details/132478445" target="_blank" rel="noopener noreffer ">WSL2 切换默认的 Linux 子系统</a></li>
<li><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener noreffer ">镜像加速器</a></li>
<li><a href="https://wangdoc.com/ssh/server" target="_blank" rel="noopener noreffer ">SSH 服务器</a></li>
<li><a href="https://www.cnblogs.com/jackadam/p/9290366.html" target="_blank" rel="noopener noreffer ">Alpine Linux 常用命令</a></li>
<li><a href="https://wiki.alpinelinux.org/wiki/Setting_up_a_SSH_server?ref=angelsanchez.me" target="_blank" rel="noopener noreffer ">Setting up a SSH server</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/507876254" target="_blank" rel="noopener noreffer ">通过 SSH 在远程和本地系统之间传输文件的 4 种方法</a></li>
<li><a href="https://juejin.cn/post/7248827630866415674" target="_blank" rel="noopener noreffer ">docker 搭建本地/局域网仓库</a></li>
<li><a href="https://docker-practice.github.io/zh-cn/repository/registry.html" target="_blank" rel="noopener noreffer ">私有仓库</a></li>
<li><a href="https://dwaves.de/2017/06/14/about-x11-display-server-display-or-login-manager-window-manager/" target="_blank" rel="noopener noreffer ">about – x11 display server – display or login manager – window manager</a></li>
<li><a href="https://www.cnblogs.com/larva-zhh/p/10531824.html" target="_blank" rel="noopener noreffer ">在 Docker for Windows 中运行 GUI 程序</a></li>
<li><a href="https://dev.to/darksmile92/run-gui-app-in-linux-docker-container-on-windows-host-4kde" target="_blank" rel="noopener noreffer ">Run GUI app in linux docker container on windows host</a></li>
<li><a href="https://askubuntu.com/questions/456689/error-xdg-runtime-dir-not-set-in-the-environment-when-attempting-to-run-naut" target="_blank" rel="noopener noreffer ">&ldquo;error: XDG_RUNTIME_DIR not set in the environment.&rdquo; when attempting to run nautilus as root</a></li>
<li><a href="https://www.cnblogs.com/ruiyang-/p/10185840.html" target="_blank" rel="noopener noreffer ">Docker 容器图形界面显示（运行 GUI 软件）的配置方法</a></li>
<li><a href="https://wiki.segger.com/J-Link_Docker_Container" target="_blank" rel="noopener noreffer ">J-Link Docker Container</a></li>
<li><a href="https://www.voidking.com/dev-win10-docker-usb/" target="_blank" rel="noopener noreffer ">Win10 中的 Docker 使用 USB 设备</a></li>
<li><a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/Server.html" target="_blank" rel="noopener noreffer ">Using the gdbserver Program</a></li>
<li><a href="https://johnmcnelly.com/developing-on-the-rp2040-pi-pico-with-docker-and-jlink/" target="_blank" rel="noopener noreffer ">Developing on the RP2040 / Pi Pico with Docker and JLink</a></li>
<li><a href="https://blog.csdn.net/niu_88/article/details/127347197" target="_blank" rel="noopener noreffer ">vscode + jlink + GDBServer 在线调试</a></li>
<li><a href="https://wiki.segger.com/J-Link_GDB_Server" target="_blank" rel="noopener noreffer ">J-Link GDB Server</a></li>
<li><a href="https://mightydevices.com/index.php/2019/09/stm32-development-env-for-windows-vscode-arm-gcc-toolchain-openocd/" target="_blank" rel="noopener noreffer ">STM32 Development Env for Windows: VSCode + ARM GCC Toolchain + OpenOCD</a></li>
<li><a href="https://wiki.segger.com/WSL" target="_blank" rel="noopener noreffer ">WSL</a></li>
<li><a href="https://goharbor.io/docs/2.10.0/install-config/run-installer-script/" target="_blank" rel="noopener noreffer ">Run the Installer Script</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/294933020" target="_blank" rel="noopener noreffer ">VS Code Server 离线安装过程</a></li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2024-03-09</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/docker-%E9%85%8D%E7%BD%AE/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://kali20177.github.io/docker-%E9%85%8D%E7%BD%AE/" data-title="Docker 基础"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="https://kali20177.github.io/docker-%E9%85%8D%E7%BD%AE/" data-title="Docker 基础"><i class="fab fa-evernote fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/vscode-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" class="prev" rel="prev" title="VSCode 配置文件和文档生成"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>VSCode 配置文件和文档生成</a>
            <a href="/whisper-%E8%AF%AD%E9%9F%B3%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8/" class="next" rel="next" title="Whisper 语音模型使用">Whisper 语音模型使用<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">mufasa</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":20},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
