<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>[未完成] C&#43;&#43; 基本概念 - mufasa 个人站</title><meta name="Description" content="mufasa 个人站"><meta property="og:title" content="[未完成] C&#43;&#43; 基本概念" />
<meta property="og:description" content="C 风格数组退化 C 语言传递数组时，数组类型会退化（decay）成指针类型，同时丢失长度信息。 C 风格的数组在大多数情况下退化为指针，认为数组 = 指" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kali20177.github.io/draft/cpp/c&#43;&#43;-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" /><meta property="og:image" content="https://kali20177.github.io/logo.png" /><meta property="article:section" content="draft" />
<meta property="article:published_time" content="2024-02-25T20:12:56+08:00" />
<meta property="article:modified_time" content="2024-02-25T20:12:56+08:00" /><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://kali20177.github.io/logo.png" /><meta name="twitter:title" content="[未完成] C&#43;&#43; 基本概念"/>
<meta name="twitter:description" content="C 风格数组退化 C 语言传递数组时，数组类型会退化（decay）成指针类型，同时丢失长度信息。 C 风格的数组在大多数情况下退化为指针，认为数组 = 指"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://kali20177.github.io/draft/cpp/c&#43;&#43;-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" /><link rel="prev" href="https://kali20177.github.io/draft/cpp/c&#43;&#43;-%E5%B9%B6%E5%8F%91/" /><link rel="next" href="https://kali20177.github.io/draft/%E5%B5%8C%E5%85%A5%E5%BC%8F/qp%E7%8A%B6%E6%80%81%E6%9C%BA%E7%BC%96%E7%A8%8B/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "[未完成] C++ 基本概念",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kali20177.github.io\/draft\/cpp\/c\u002b\u002b-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\/"
        },"genre": "draft","wordcount":  3512 ,
        "url": "https:\/\/kali20177.github.io\/draft\/cpp\/c\u002b\u002b-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5\/","datePublished": "2024-02-25T20:12:56+08:00","dateModified": "2024-02-25T20:12:56+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "mufasa"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="mufasa 个人站">Mufasa&#39;s blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="mufasa 个人站">Mufasa&#39;s blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="page single special"><h1 class="single-title animate__animated animate__pulse animate__faster">[未完成] C&#43;&#43; 基本概念</h1><div class="content" id="content"><h2 id="c-风格数组退化">C 风格数组退化</h2>
<p>C 语言传递数组时，数组类型会退化（decay）成指针类型，同时丢失长度信息。</p>
<blockquote>
<p>C 风格的数组在大多数情况下退化为指针，认为数组 = 指针是常见的谬误。数组是一个元素序列，而指针只保存一个地址。</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// [] 中的长度是无效的，所以不需要填
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">printElementZero</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">arr</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">length</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 等同于
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">printElementZero</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span><span class="o">*</span> <span class="n">arr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="字符串">字符串</h2>
<h3 id="c-风格字符串">C 风格字符串</h3>
<p>C 风格的两种字符串定义方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">char</span> <span class="n">name</span><span class="p">[]</span> <span class="p">{</span> <span class="s">&#34;Alex&#34;</span> <span class="p">};</span>        <span class="c1">// case 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">color</span><span class="p">{</span> <span class="s">&#34;Orange&#34;</span> <span class="p">};</span> <span class="c1">// case 2
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>case 1 中，&ldquo;Alex\0&rdquo; 先分配在只读段，然后 char 类型长度为 5 的数组，再使用 &ldquo;Alex\0&rdquo; 填充。所以存在两个副本。</p>
<p>case 2 中，&ldquo;Orange&rdquo; 被放入只读段，使用字符串的地址初始化指针。</p>
<p>auto 推导字符串：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">s1</span><span class="p">{</span> <span class="s">&#34;Alex&#34;</span> <span class="p">};</span>  <span class="c1">// type deduced as const char*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">auto</span><span class="o">*</span> <span class="n">s2</span><span class="p">{</span> <span class="s">&#34;Alex&#34;</span> <span class="p">};</span> <span class="c1">// type deduced as const char*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">s3</span><span class="p">{</span> <span class="s">&#34;Alex&#34;</span> <span class="p">};</span> <span class="c1">// type deduced as const char(&amp;)[5]
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="操作符">操作符</h2>
<h3 id="sizeof">sizeof</h3>
<p>语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">sizeof</span><span class="p">(</span> <span class="err">类型</span> <span class="p">)</span>	<span class="p">(</span><span class="mi">1</span><span class="p">)</span>	
</span></span><span class="line"><span class="cl"><span class="k">sizeof</span> <span class="err">表达式</span>	<span class="p">(</span><span class="mi">2</span><span class="p">)</span>	
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>sizeof 的结果始终非零，即使应用于空类。</li>
<li>当应用于某个表达式时，sizeof <strong>不对表达式进行求值</strong>，即便表达式代表多态对象，它的结果也是该表达式的静态类型的大小。</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">b</span> <span class="o">=</span> <span class="k">sizeof</span> <span class="o">++</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cv-限定符">CV 限定符</h2>
<ul>
<li>const —— 定义类型为常量类型，reade only。</li>
<li>volatile —— 定义类型为易变类型。</li>
</ul>
<blockquote>
<ol>
<li>直接修改 const 修饰的变量会编译失败，通过指针或引用修改则行为未定义</li>
<li>一般需要关键字 volatile 的场合：
<ul>
<li>Memory-mapped peripheral registers</li>
<li>Global variables modified by an interrupt service routine</li>
<li>Global variables within a multi-threaded application</li>
</ul>
</li>
</ol>
</blockquote>
<p>不应该将二者理解成反义词：</p>
<ol>
<li>const 保证被修饰的变量不会被程序（程度员）修改，但不负责源码以外被修改的情况。</li>
<li>volatile 说明变量可能被硬件改变，告知编译器不要优化此处</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">uint8_t</span> <span class="k">volatile</span> <span class="o">*</span><span class="k">const</span> <span class="n">pReg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="mh">0x40000000</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">uint8_t</span> <span class="k">const</span> <span class="k">volatile</span> <span class="o">*</span><span class="k">const</span> <span class="n">pReg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="mh">0x40000000</span><span class="p">;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>第一句说明常量指针 pReg 指向的 uint8_t 类型值，即地址 0x40000000 处的值可能被硬件修改。第二句说明，0x40000000 处的值可能被硬件修改，但不允许程序员修改。</p>
<h2 id="auto--decltype">auto / decltype</h2>
<p>auto 自动类型推导：</p>
<ul>
<li>auto 总是优先推导为值类型</li>
<li>可以结合 cv 限定符，* 和 &amp; 得到新类型</li>
<li>auto&amp;&amp; 可被推导成左值引用或右值引用类型</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10L</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span><span class="o">&amp;</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span><span class="o">*</span> <span class="n">x2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">x4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">x3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="n">x5</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>decltype 不仅能推导出值类型，还可以推导出引用类型。</p>
<table>
<thead>
<tr>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>decltype ( 实体 )</td>
<td>(1)	(C++11 起)</td>
</tr>
<tr>
<td>decltype ( 表达式 )</td>
<td>(2)	(C++11 起)</td>
</tr>
</tbody>
</table>
<p>cppref: 注意如果对象的名字带有括号，那么它会被当做普通的左值表达式，因此 decltype(x) 和 decltype((x)) 通常是不同的类型。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">decltype</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">&amp;</span> <span class="n">z2</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>  <span class="c1">// z2 推导为 int&amp;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">decltype</span><span class="p">(</span><span class="n">z2</span><span class="p">)</span> <span class="n">z6</span> <span class="o">=</span> <span class="n">z2</span><span class="p">;</span> <span class="c1">// z6 推导为 int&amp;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">auto</span> <span class="n">z7</span> <span class="o">=</span> <span class="n">z2</span><span class="p">;</span>         <span class="c1">// z7 推导为 int
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>C++14 后，如果占位类型说明符是 decltype(auto)，那么推导出的类型是 decltype(expr)。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">);</span>  <span class="c1">// 推导为 int&amp;, 因为（expr）是引用类型。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">y2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">;</span>   <span class="c1">// 推导为 int*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span> <span class="n">y3</span> <span class="o">=</span> <span class="n">y1</span><span class="p">;</span>   <span class="c1">// 推导为 int&amp;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="引用">引用</h2>
<p>C 语言中的 NULL 可以被定义为 0、0L、<code>((void*)0)</code> 或者其他，当空指针仍然使用 NULL 时，可能会出现问题：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;print(int): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">print</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span> <span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;print(int*): &#34;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">?</span> <span class="s">&#34;non-null</span><span class="se">\n</span><span class="s">&#34;</span> <span class="o">:</span> <span class="s">&#34;null</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>  <span class="c1">// clang / gcc 下编译错误，MSVC print(int)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">print</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="初始化">初始化</h2>
<blockquote>
<p>C++ 中，初始化不等于赋值 &ndash; C++ primer</p>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/CPP/Cpp_initialization.png"
        data-srcset="/CPP/Cpp_initialization.png, /CPP/Cpp_initialization.png 1.5x, /CPP/Cpp_initialization.png 2x"
        data-sizes="auto"
        alt="/CPP/Cpp_initialization.png"
        title="Cpp_initialization" /></p>
<p>总体而言，C++ 的初始器 (initializer) 分为：</p>
<ol>
<li>复制初始化 <code> = expression</code></li>
<li>直接初始化 <code>( )</code></li>
<li>列表初始化 <code> = { }</code></li>
</ol>
<p>复制初始化可能调用非 explicit 的构造函数，拷贝构造函数，或者是移动构造函数。</p>
<h2 id="函数重载">函数重载</h2>
<p>// TODO:
重载函数规则：</p>
<p>注意，重载函数之间不一定需要完全独立，可以通过委托已经实现的同名函数进行重载，比如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">printMessage</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Message: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">printMessage</span><span class="p">(</span><span class="kt">int</span> <span class="n">number</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">printMessage</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">number</span><span class="p">));</span> <span class="c1">// 嵌套调用另一个重载函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">printMessage</span><span class="p">(</span><span class="s">&#34;Hello, World!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">printMessage</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这种手段可以增强复用性。</p>
<h2 id="枚举">枚举</h2>
<h3 id="c-style-enum">C-style enum</h3>
<p>普通枚举，将被隐式转换成整数，类型不安全。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">enum</span> <span class="nc">Color</span> <span class="p">{</span>  <span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span>  <span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>枚举名称非必须，但现代 C++ 应避免未命名的枚举。</p>
<p>可以指定枚举的基础类型，默认一般是 int。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">enum</span> <span class="nc">Color</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="kt">int8_t</span> <span class="p">{</span>  <span class="n">black</span><span class="p">,</span><span class="n">red</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="enum-class">enum class</h3>
<p>枚举类不属于类类型，需要作用域解析运算符访问，能避免和其他枚举定义重名的问题，不会隐式转换成整数，类型安全。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Color</span> <span class="p">{</span>  <span class="n">red</span><span class="p">,</span><span class="n">green</span><span class="p">,</span><span class="n">blue</span><span class="p">,</span>  <span class="p">};</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>C++ 20 起 using 可用于枚举：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">Status</span><span class="p">{</span><span class="n">open</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="mi">9</span><span class="p">}</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">Status</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">switch</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">using</span> <span class="k">enum</span> <span class="nc">Status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 或者：using Status::open, Status::done, Status::progress;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">case</span> <span class="nl">open</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;open&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nl">progress</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;in progress&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nl">done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;done&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="函数指针和-stdfunction">函数指针和 std::function</h2>
<p>TODO:</p>
<blockquote>
<p>技巧：using + decltype 完成函数指针获取</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="n">add_ptr_t</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="o">&amp;</span><span class="n">add</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">add_ptr_t</span> <span class="n">my_add_ptr</span> <span class="o">=</span> <span class="n">add</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="表达式">表达式</h2>
<p>表达式是运算符和它们的操作数的序列，指定一项计算。</p>
<h3 id="初等表达式primary-expressions">初等表达式（Primary expressions）</h3>
<p>包括：</p>
<ul>
<li>this</li>
<li>字面量（例如 2 或 &ldquo;Hello, world&rdquo;）</li>
<li>标识表达式</li>
<li>lambda 表达式 (C++11 起)</li>
<li>折叠表达式 (C++17 起)</li>
<li>requires 表达式 (C++20 起)</li>
</ul>
<p>任何带括号表达式也被归类为初等表达式。</p>
<h3 id="常量表达式">常量表达式</h3>
<p>constexpr 和 const 存在结合使用的场景，例如下面的代码会出现警告：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span> <span class="o">=</span> <span class="s">&#34;Hello, world!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="nl">warning</span><span class="p">:</span> <span class="n">ISO</span> <span class="n">C</span><span class="o">++</span> <span class="n">forbids</span> <span class="n">converting</span> <span class="n">a</span> <span class="n">string</span> <span class="n">constant</span> <span class="n">to</span> <span class="err">‘</span><span class="kt">char</span><span class="o">*</span><span class="err">’</span> <span class="p">[</span><span class="o">-</span><span class="n">Wwrite</span><span class="o">-</span><span class="n">strings</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>constexpr 会隐式在顶层添加一个 const 限定符：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="n">T</span> <span class="n">a</span> <span class="o">=</span> <span class="n">xxx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 等价于：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">T</span> <span class="k">const</span> <span class="n">a</span> <span class="o">=</span> <span class="n">xxx</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>因此字符串本身的常量性未修饰。应该修改为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="s">&#34;Hello, world!&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>思考下面的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> *           +----------+ +-----+ +-----+     
</span></span></span><span class="line"><span class="cl"><span class="cm"> * +-------- |const char|*|const|*|const| p  
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |         +----------+ +--+--+ +--+--+     
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |                         |       |        
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    +--------------------+       |        
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |                            |        
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |           +----------------+        
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |           |                         
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |           v      +-----------------+
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |          ptr  --&gt;|     0x1000      |
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |                  +-----------------+
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |                                     
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    |                  +-----------------+
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |    +-------&gt; 0x1000--&gt;|     0x2000      |
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |                       +-----------------+
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |                                          
</span></span></span><span class="line"><span class="cl"><span class="cm"> * |                       +-----------------+
</span></span></span><span class="line"><span class="cl"><span class="cm"> * +------------&gt; 0x2000--&gt;|       &#39;A&#39;       |
</span></span></span><span class="line"><span class="cl"><span class="cm"> *                         +-----------------+
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">constexpr</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="o">*</span> <span class="n">pp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">char</span> <span class="n">b</span> <span class="o">=</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="n">q</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span> <span class="o">*</span> <span class="k">const</span> <span class="n">qq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="完整表达式full-expression">完整表达式（Full-Expression）</h3>
<ol>
<li>初始化</li>
<li>常量表达式</li>
<li>立即调用（consteval）</li>
<li>未求值的操作数</li>
<li>不是子表达式的表达式</li>
</ol>
<blockquote>
<p>右值对象在创建它的完整表达式的末尾被销毁。对右值对象成员的任何引用都将在该点悬空。对右值对象成员的引用只能在创建右值对象的完整表达式中安全使用。</p>
</blockquote>
<p>下面的 case2 属于未定义行为。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Employee</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_name</span><span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">setName</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span> <span class="n">m_name</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">getName</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">m_name</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//  getter returns by const reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// createEmployee() returns an Employee by value (which means the returned value is an rvalue)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Employee</span> <span class="nf">createEmployee</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Employee</span> <span class="n">e</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">e</span><span class="p">.</span><span class="n">setName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">e</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Case 1: okay: use returned reference to member of rvalue class object in same expression
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">createEmployee</span><span class="p">(</span><span class="s">&#34;Frank&#34;</span><span class="p">).</span><span class="n">getName</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Case 2: bad: save returned reference to member of rvalue class object for use later
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">ref</span> <span class="p">{</span> <span class="n">createEmployee</span><span class="p">(</span><span class="s">&#34;Garbo&#34;</span><span class="p">).</span><span class="n">getName</span><span class="p">()</span> <span class="p">};</span> <span class="c1">// reference becomes dangling when return value of createEmployee() is destroyed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ref</span><span class="p">;</span> <span class="c1">// undefined behavior
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Case 3: okay: copy referenced value to local variable for use later
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">val</span> <span class="p">{</span> <span class="n">createEmployee</span><span class="p">(</span><span class="s">&#34;Hans&#34;</span><span class="p">).</span><span class="n">getName</span><span class="p">()</span> <span class="p">};</span> <span class="c1">// makes copy of referenced member
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">val</span><span class="p">;</span> <span class="c1">// okay: val is independent of referenced member
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="仿函数functor">仿函数（functor）</h2>
<p>通过在类内对 <code>()</code> 运算符进行重载可以得到仿函数，也称函数对象。仿函数可以拥有初始状态，一般通过 class 定义私有成员，在声明对象时初始化，私有成员的状态成为仿函数的初始状态。带状态的仿函数与 lambda 类似，仿函数可以用于实现 lambda 表达式（C++11）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tax</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">rate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">base</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tax</span><span class="p">(</span><span class="kt">float</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span><span class="n">rate</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">base</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">float</span> <span class="n">money</span><span class="p">){</span> <span class="k">return</span> <span class="p">(</span><span class="n">money</span> <span class="o">-</span> <span class="n">base</span><span class="p">)</span><span class="o">*</span><span class="n">rate</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// &lt;-- functor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Tax</span> <span class="n">high</span><span class="p">(</span><span class="mf">0.40</span><span class="p">,</span> <span class="mi">30000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tax</span> <span class="n">middle</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">20000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;tax over 3w: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">high</span><span class="p">(</span><span class="mi">37500</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;tax over 2w: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">middle</span><span class="p">(</span><span class="mi">27500</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lambda">lambda</h2>
<h2 id="偏函数">偏函数</h2>
<p>参数较多的函数，某些场合我们会固定某些参数，只用某种特化的可调用对象。使用 <code>std::bind</code> 固定某些参数，其余参数使用用 <code>std::placeholders</code> 占位符占位即可实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 函数：将任意进制的数转换为十进制数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">anyBaseToDecimal</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">base</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">decimalNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">power</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">num</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">digit</span> <span class="o">=</span> <span class="n">isdigit</span><span class="p">(</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">?</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span> <span class="o">:</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">decimalNum</span> <span class="o">+=</span> <span class="n">digit</span> <span class="o">*</span> <span class="n">pow</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">power</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">power</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">decimalNum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 使用 std::bind 和 std::placeholders 构造特定进制转换的偏函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span><span class="nl">std</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 绑定转换为二进制的偏函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">auto</span> <span class="n">binaryConverter</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">anyBaseToDecimal</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Binary to Decimal: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">binaryConverter</span><span class="p">(</span><span class="s">&#34;1010&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 绑定转换为十六进制的偏函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">auto</span> <span class="n">hexConverter</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">anyBaseToDecimal</span><span class="p">,</span> <span class="o">:</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Hexadecimal to Decimal: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">hexConverter</span><span class="p">(</span><span class="s">&#34;1A&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="智能指针">智能指针</h2>
<h2 id="new-操作符">new 操作符</h2>
<h3 id="placement-new">placement new</h3>
<p>允许在被指定位置构造对象，可以在栈、静态区等位置构建。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">MyObject</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">MyObject</span><span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">)</span> <span class="o">:</span> <span class="n">value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">MyObject</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Define a static buffer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">alignas</span><span class="p">(</span><span class="n">MyObject</span><span class="p">)</span> <span class="k">static</span> <span class="kt">uint8_t</span> <span class="n">buf</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">MyObject</span><span class="p">)];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="n">MyObject</span><span class="o">*</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="n">MyObject</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span> <span class="c1">// Placement new to construct object in buf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Use the object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// For example, calling a member function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">obj</span><span class="o">-&gt;~</span><span class="n">MyObject</span><span class="p">();</span> <span class="c1">// Explicitly call the destructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="转换conversions">转换（Conversions）</h2>
<p>C++ 的四种类型转换：</p>
<ul>
<li>static_cast 转换一个类型为另一相关类型</li>
<li>dynamic_cast 在继承层级中转换</li>
<li>const_cast 添加或移除 cv 限定符</li>
<li>reinterpret_cast 转换类型到无关类型</li>
</ul>
<p>相比之下，C++ 的类型转换每次只转换类型的一个方面，C 风格的转换行为难以控制。</p>
<h2 id="字面量literals">字面量（Literals）</h2>
<p>用以表现嵌入到源代码中的常量值的记号，主要有整数、字符、浮点、字符串、bool、nullptr 和用户定义字面量。</p>
<h3 id="分隔符c14">分隔符（C++14）</h3>
<p>数字之间可使用单引号分隔符，方便阅读，编译时会忽略：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mb">0b0001&#39;1001&#39;0001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">3.141</span><span class="err">&#39;</span><span class="mi">5926&#39;5358&#39;9793&#39;2385</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>类似于 Python 3.6 中数字的下划线：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">1_000_000</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mf">3.68_796</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="用户定义字面量">用户定义字面量</h3>
<h2 id="initializer_list">initializer_list</h2>
<p><code>std::initializer_list&lt;T&gt;</code> 类型的对象是轻量代理对象，在编译时创建 const T 的对象数组，提供迭代器和 size()。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="nl">x</span> <span class="p">:</span> <span class="p">{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;coding&#34;</span><span class="p">,</span> <span class="s">&#34;world&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可通过 cppinsights 查看实际执行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">__list4_19</span><span class="p">[</span><span class="mi">3</span><span class="p">]{</span><span class="s">&#34;hello&#34;</span><span class="p">,</span> <span class="s">&#34;coding&#34;</span><span class="p">,</span> <span class="s">&#34;world&#34;</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="o">&amp;&amp;</span> <span class="n">__range1</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span><span class="p">{</span><span class="n">__list4_19</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="o">*</span> <span class="n">__begin1</span> <span class="o">=</span> <span class="n">__range1</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="o">*</span> <span class="n">__end1</span> <span class="o">=</span> <span class="n">__range1</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(;</span> <span class="n">__begin1</span> <span class="o">!=</span> <span class="n">__end1</span><span class="p">;</span> <span class="o">++</span><span class="n">__begin1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">__begin1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意：</p>
<ol>
<li>std::initializer_list 是“视图”类型，主要用于传递函数参数，如果用作返回值则面临生命周期的问题。</li>
<li>编译时创建的 const T 分配在栈空间或者只读内存上。</li>
</ol>
<h2 id="值类别">值类别</h2>
<h2 id="异常">异常</h2>
<p>一般认为，重要的构造函数、复制构造函数和移动构造函数应该尽量声明为 noexcept，析构函数则必须保证不抛出异常。</p>
<h2 id="参考">参考</h2>
<ol>
<li><a href="https://www.learncpp.com/cpp-tutorial/c-style-array-decay/" target="_blank" rel="noopener noreffer ">C-style array decay</a></li>
<li><a href="https://www.learncpp.com/cpp-tutorial/c-style-string-symbolic-constants/" target="_blank" rel="noopener noreffer ">C-style string symbolic constants</a></li>
<li><a href="https://fastbitlab.com/microcontroller-embedded-c-programming-lecture-143-usage-of-const-and-volatile-together/" target="_blank" rel="noopener noreffer ">Microcontroller Embedded C Programming Lecture 143: Usage of const and volatile together</a></li>
<li><a href="https://www.quora.com/What-does-a-variable-that-is-both-const-and-volatile-mean" target="_blank" rel="noopener noreffer ">What does a variable that is both const and volatile mean?</a></li>
<li><a href="https://www.learncpp.com/cpp-tutorial/pass-by-address-part-2/" target="_blank" rel="noopener noreffer ">Pass by address</a></li>
<li><a href="https://zh.cppreference.com/w/cpp/language/copy_initialization" target="_blank" rel="noopener noreffer ">复制初始化</a></li>
<li><a href="https://www.learncpp.com/cpp-tutorial/member-functions-returning-references-to-data-members/" target="_blank" rel="noopener noreffer ">Member functions returning references to data members</a></li>
<li><a href="https://www.cnblogs.com/apocelipes/p/14769971.html" target="_blank" rel="noopener noreffer ">使用 constexpr 时遇到的小坑</a></li>
<li><a href="https://www.cnblogs.com/zyk1113/p/13217312.html" target="_blank" rel="noopener noreffer ">C++11 lambda 表达式与仿函数</a></li>
<li><a href="https://cui-jiacai.gitbook.io/c&#43;&#43;-stl-tutorial/fang-han-shu-functor#pian-han-shu" target="_blank" rel="noopener noreffer ">仿函数</a></li>
<li><a href="https://en.cppreference.com/w/cpp/language/new" target="_blank" rel="noopener noreffer ">new expression</a></li>
<li><a href="https://zh.cppreference.com/w/cpp/language/expressions" target="_blank" rel="noopener noreffer ">表达式</a></li>
<li><a href="https://zhxilin.github.io/post/tech_stack/1_programming_language/modern_cpp/cpp11/user_defined_literal/#%E5%AD%97%E9%9D%A2%E9%87%8F" target="_blank" rel="noopener noreffer ">字面量</a></li>
<li><a href="https://zhxilin.github.io/post/tech_stack/1_programming_language/modern_cpp/cpp14/more_cpp14/" target="_blank" rel="noopener noreffer ">C++14 更多新特性</a></li>
<li><a href="https://www.cppstories.com/2023/initializer_list_basics/#intro-to-the-stdinitializer_list" target="_blank" rel="noopener noreffer ">std::initializer_list in C++ 1/2 - Internals and Use Cases</a></li>
</ol>
</div></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">mufasa</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":20},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
